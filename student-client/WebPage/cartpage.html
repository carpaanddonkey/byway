<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>顺道儿——购物车</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css\general_style.css" type="text/css" />
        <link href="css\cart_style.css" rel="stylesheet" type="text/css" />
        <script src = "js/jquery-1.8.2.min.js"></script>
        <script src = "js/menu.js"></script>
        <script src = "js/cookies.js"></script>
        <script type="text/javascript">
        var txt = "";
        //var str = '[{"if_self_help": 0, "address": "16\u53f7\u697c419\u5bbf\u820d1\u53f7\u5e8a", "canteen_id": 1, "id": 17, "nowa_id": 0, "window_name": "\u98ce\u5473\u7092\u83dc", "product_price": 48.0, "qr_storage_url": "api.byway.net.cn/media/qrcode/17.jpg", "combo_id": "1_2_0", "customer_id": 2, "status": 0, "if_paid": 0, "deliver": "\u6682\u65f6\u65e0\u4eba\u63a5\u5355", "window_id": 1, "window_icon": "http://api.byway.net.cn/media/windows/1.jpg", "promotion": 0.0, "ship_price": 0.0, "total_price": 48.0, "product_details": [{"product_count": 1, "col_price": 10.0, "product_name": "\u7ea2\u70e7\u8106\u9aa8"}, {"product_count": 2, "col_price": 24.0, "product_name": "\u9ebb\u5a46\u8c46\u8150"}, {"product_count": 1, "col_price": 14.0, "product_name": "\u849c\u84c9\u751f\u83dc"}], "leave_msg": "\u4f60\u597d", "product_list": "1-1_3-2_4-1", "expect_time": "\u5c3d\u5feb\u9001\u8fbe"}, {"if_self_help": 0, "address": "16\u53f7\u697c419\u5bbf\u820d1\u53f7\u5e8a", "canteen_id": 1, "id": 18, "nowa_id": 0, "window_name": "\u98ce\u5473\u7092\u83dc", "product_price": 48.0, "qr_storage_url": "api.byway.net.cn/media/qrcode/18.jpg", "combo_id": "1_2_0", "customer_id": 2, "status": 0, "if_paid": 0, "deliver": "\u6682\u65f6\u65e0\u4eba\u63a5\u5355", "window_id": 1, "window_icon": "http://api.byway.net.cn/media/windows/1.jpg", "promotion": 0.0, "ship_price": 0.0, "total_price": 48.0, "product_details": [{"product_count": 1, "col_price": 10.0, "product_name": "\u7ea2\u70e7\u8106\u9aa8"}, {"product_count": 2, "col_price": 24.0, "product_name": "\u9ebb\u5a46\u8c46\u8150"}, {"product_count": 1, "col_price": 14.0, "product_name": "\u849c\u84c9\u751f\u83dc"}], "leave_msg": "\u4f60\u597d", "product_list": "1-1_3-2_4-1", "expect_time": "\u5c3d\u5feb\u9001\u8fbe"}, {"if_self_help": 0, "address": "16\u53f7\u697c419\u5bbf\u820d1\u53f7\u5e8a", "canteen_id": 1, "id": 19, "nowa_id": 0, "window_name": "\u98ce\u5473\u7092\u83dc", "product_price": 22.0, "qr_storage_url": "api.byway.net.cn/media/qrcode/19.jpg", "combo_id": "1_2_0", "customer_id": 2, "status": 0, "if_paid": 0, "deliver": "\u6682\u65f6\u65e0\u4eba\u63a5\u5355", "window_id": 1, "window_icon": "http://api.byway.net.cn/media/windows/1.jpg", "promotion": 0.0, "ship_price": 0.0, "total_price": 22.0, "product_details": [{"product_count": 1, "col_price": 10.0, "product_name": "\u7ea2\u70e7\u8106\u9aa8"}, {"product_count": 1, "col_price": 12.0, "product_name": "\u9ebb\u5a46\u8c46\u8150"}], "leave_msg": "", "product_list": "1-1_3-1", "expect_time": "\u5c3d\u5feb\u9001\u8fbe"}, {"if_self_help": 0, "address": "16\u53f7\u697c419\u5bbf\u820d1\u53f7\u5e8a", "canteen_id": 1, "id": 20, "nowa_id": 0, "window_name": "\u98ce\u5473\u7092\u83dc", "product_price": 30.0, "qr_storage_url": "api.byway.net.cn/media/qrcode/20.jpg", "combo_id": "1_2_0", "customer_id": 2, "status": 0, "if_paid": 0, "deliver": "\u6682\u65f6\u65e0\u4eba\u63a5\u5355", "window_id": 1, "window_icon": "http://api.byway.net.cn/media/windows/1.jpg", "promotion": 0.0, "ship_price": 3.0, "total_price": 33.0, "product_details": [{"product_count": 3, "col_price": 30.0, "product_name": "\u756a\u8304\u9e21\u86cb"}], "leave_msg": "", "product_list": "2-3", "expect_time": "2016-05-31 19:04:47"}, {"if_self_help": 0, "address": "16\u53f7\u697c419\u5bbf\u820d1\u53f7\u5e8a", "canteen_id": 1, "id": 21, "nowa_id": 0, "window_name": "\u98ce\u5473\u7092\u83dc", "product_price": 52.0, "qr_storage_url": "api.byway.net.cn/media/qrcode/21.jpg", "combo_id": "1_2_0", "customer_id": 2, "status": 0, "if_paid": 0, "deliver": "\u6682\u65f6\u65e0\u4eba\u63a5\u5355", "window_id": 1, "window_icon": "http://api.byway.net.cn/media/windows/1.jpg", "promotion": 0.0, "ship_price": 0.0, "total_price": 52.0, "product_details": [{"product_count": 2, "col_price": 20.0, "product_name": "\u7ea2\u70e7\u8106\u9aa8"}, {"product_count": 2, "col_price": 20.0, "product_name": "\u756a\u8304\u9e21\u86cb"}, {"product_count": 1, "col_price": 12.0, "product_name": "\u9ebb\u5a46\u8c46\u8150"}], "leave_msg": "", "product_list": "1-2_2-2_3-1", "expect_time": "2016-05-31 19:15:29"}, {"if_self_help": 0, "address": "16\u53f7\u697c419\u5bbf\u820d1\u53f7\u5e8a", "canteen_id": 1, "id": 22, "nowa_id": 0, "window_name": "\u98ce\u5473\u7092\u83dc", "product_price": 52.0, "qr_storage_url": "api.byway.net.cn/media/qrcode/22.jpg", "combo_id": "1_2_0", "customer_id": 2, "status": 0, "if_paid": 0, "deliver": "\u6682\u65f6\u65e0\u4eba\u63a5\u5355", "window_id": 1, "window_icon": "http://api.byway.net.cn/media/windows/1.jpg", "promotion": 0.0, "ship_price": 0.0, "total_price": 52.0, "product_details": [{"product_count": 2, "col_price": 20.0, "product_name": "\u7ea2\u70e7\u8106\u9aa8"}, {"product_count": 2, "col_price": 20.0, "product_name": "\u756a\u8304\u9e21\u86cb"}, {"product_count": 1, "col_price": 12.0, "product_name": "\u9ebb\u5a46\u8c46\u8150"}], "leave_msg": "", "product_list": "1-2_2-2_3-1", "expect_time": "2016-05-31 19:16:04"}, {"if_self_help": 0, "address": "16\u53f7\u697c419\u5bbf\u820d1\u53f7\u5e8a", "canteen_id": 1, "id": 23, "nowa_id": 0, "window_name": "\u98ce\u5473\u7092\u83dc", "product_price": 52.0, "qr_storage_url": "api.byway.net.cn/media/qrcode/23.jpg", "combo_id": "1_2_0", "customer_id": 2, "status": 0, "if_paid": 0, "deliver": "\u6682\u65f6\u65e0\u4eba\u63a5\u5355", "window_id": 1, "window_icon": "http://api.byway.net.cn/media/windows/1.jpg", "promotion": 0.0, "ship_price": 0.0, "total_price": 52.0, "product_details": [{"product_count": 2, "col_price": 20.0, "product_name": "\u7ea2\u70e7\u8106\u9aa8"}, {"product_count": 2, "col_price": 20.0, "product_name": "\u756a\u8304\u9e21\u86cb"}, {"product_count": 1, "col_price": 12.0, "product_name": "\u9ebb\u5a46\u8c46\u8150"}], "leave_msg": "", "product_list": "1-2_2-2_3-1", "expect_time": "2016-05-31 19:16:38"}, {"if_self_help": 0, "address": "16\u53f7\u697c419\u5bbf\u820d1\u53f7\u5e8a", "canteen_id": 1, "id": 24, "nowa_id": 0, "window_name": "\u98ce\u5473\u7092\u83dc", "product_price": 10.0, "qr_storage_url": "api.byway.net.cn/media/qrcode/24.jpg", "combo_id": "1_2_0", "customer_id": 2, "status": 0, "if_paid": 0, "deliver": "\u6682\u65f6\u65e0\u4eba\u63a5\u5355", "window_id": 1, "window_icon": "http://api.byway.net.cn/media/windows/1.jpg", "promotion": 0.0, "ship_price": 0.0, "total_price": 10.0, "product_details": [{"product_count": 1, "col_price": 10.0, "product_name": "\u7ea2\u70e7\u8106\u9aa8"}], "leave_msg": "", "product_list": "1-1", "expect_time": "2016-05-31 19:36:49"}]';
        function loadl(is)
        {
            window.location.href = "orderpage.html?"+is;
        }
        function getData(div_id){
            var url =  'http://api.byway.net.cn/v1/orders/?query_type=me&is_finshed=false/';
             $.ajax({
                    async:false,
                    xhrFields:{withCredentials:true},
                    type:"get",                        
                    url:url,
                    success:function(str){
                        var obj = JSON.parse(str);
                        if(typeof(obj.length)=='undefined')
                            aloadObject(obj);
                        else
                            loadJSON(obj);
                    },
                    error:function(jsonResult){
                        alert("error");
                   }
                });
            document.getElementById(div_id).innerHTML = txt;
        }
        function loadObject(arr)
        {
            var mytime = new Date();
            //for(i in arr)
            {
                txt+='<a onclick = "loadl('+arr.id+')">'+
                     '<div class="cart_data">'+
                     '<img class="dishpic" src="'+arr.window_icon+'" alt="食物图片"/><img class="spf" src="Images/icon/arrow2.png" alt="详情"/>'+
                     '<span class="di_name">'+arr.window_name+'</span>';
                //for(var j = 1;j<=5;j++)
               // {
                    //if(j<=arr.score)
                    //    txt+='<img class="rank'+j+'1" src="Images/icon/star1.png" alt=""/>';
                   // else
                       // txt+='<img class="rank'+j+'" src="Images/icon/star.png" alt=""/>';
               // }
                switch(arr.status)
                {
                    case 0:txt+='<span class = "di_al">订单等待支付</span>';break;
                    case 2:txt+='<span class="di_al">等待商家接受</span>';break;
                    case 3:txt+='<span class="di_al">订单已被商家接受</span>';break;
                    case 6:txt+='<span class="di_al">订单正在被派送</span>';break;
                }
                
                txt+='<span class="di_money">'+arr.total_price+' 元</span><p class="di_date">'+mytime.toLocaleString()+'</p></div></a>';
            }
        }

        function loadJSON(arr)
        {
            var mytime = new Date();
            for(i in arr)
            {
                txt+='<a onclick = "loadl('+arr[i].id+')">'+
                     '<div class="cart_data">'+
                     '<img class="dishpic" src="'+arr[i].window_icon+'" alt="食物图片"/><img class="spf" src="Images/icon/arrow2.png" alt="详情"/>'+
                     '<span class="di_name">'+arr[i].window_name+'</span>';
               // for(var j = 1;j<=5;j++)
               // {
                   // if(j<=arr[i].score)
                      //  txt+='<img class="rank'+j+'1" src="Images/icon/star1.png" alt=""/>';
                   // else
                      //  txt+='<img class="rank'+j+'" src="Images/icon/star.png" alt=""/>';
                //}
                switch(arr[i].status)
                {
                    case 0:txt+='<span class = "di_al">订单等待支付</span>';break;
                    case 1:txt+='<span class="di_al">订单已支付</span>';break;
                    case 2:txt+='<span class="di_al">等待商家接受</span>';break;
                    case 3:txt+='<span class="di_al">订单已被商家接受</span>';break;
                    case 6:txt+='<span class="di_al">订单正在被派送</span>';break;
                }
                
                txt+='<span class="di_money">'+arr[i].total_price+' 元</span><p class="di_date">'+mytime.toLocaleString()+'</p></div></a>';
            }
        }
        </script>
    </head>
    <body onload = "getData('cart_body')">
        <div class="header">
            <img class="back" style="height: 24px;padding-top: 7px;" src="Images\icon\white_logoicon.png" alt=""/>
            <table class="header_table">
                <tr><td class="header_table_tdleft" style="background-color: rgba(255,255,255,0.3)"> &nbsp已点订单&nbsp </td><td> <a href="cartedpage.html">&nbsp历史订单&nbsp</a></td></tr>
            </table>
            <a href="camerapage.html"><img class="scan" src="Images/icon/scanicon.png" alt="scan"/></a>
        </div>
        <div class="clearfix_head"></div>
        <div id="cart_body">
            <a href="orderpage.html">
            <div class="cart_data">
                <img class="dishpic" src="Images/dishes/dumpling.jpg" alt="食物图片"/><img class="spf" src="Images/icon/arrow2.png" alt="详情"/>
                <span class="di_name">水饺</span>
                <img class="rank1" src="Images\icon\star1.png" alt=""/><img class="rank2" src="Images\icon\star1.png" alt=""/>
                <img class="rank3" src="Images\icon\star1.png" alt=""/><img class="rank4" src="Images\icon\star1.png" alt=""/>
                <img class="rank5" src="Images\icon\star.png" alt=""/>
                <span class="di_al">订单已被商家接受</span>
                <span class="di_money">7 元</span>
                <p class="di_date">2016/4/11 19:11</p>
            </div>
            </a>
            <a href="orderpage.html">
            <div class="cart_data">
                <img class="dishpic" src="Images/dishes/fen.jpg" alt="食物图片"/><img class="spf" src="Images/icon/arrow2.png" alt="详情"/>
                <span class="di_name">牛肉粉</span>
                <img class="rank1" src="Images\icon\star1.png" alt=""/><img class="rank2" src="Images\icon\star1.png" alt=""/>
                <img class="rank3" src="Images\icon\star1.png" alt=""/><img class="rank4" src="Images\icon\star1.png" alt=""/>
                <img class="rank5" src="Images\icon\star1.png" alt=""/>
                <span class="di_al">订单正在配送</span>
                <span class="di_money">12 元</span>
                <p class="di_date">2016/4/12 19:58</p>
            </div>
            </a>
            <div class="cart_data">
                <img class="dishpic" src="Images/dishes/zhou.jpg" alt="食物图片"/><img class="spf" src="Images/icon/arrow2.png" alt="详情"/>
                <span class="di_name">皮蛋瘦肉粥</span>
                <img class="rank1" src="Images\icon\star1.png" alt=""/><img class="rank2" src="Images\icon\star1.png" alt=""/>
                <img class="rank3" src="Images\icon\star1.png" alt=""/><img class="rank4" src="Images\icon\star.png" alt=""/>
                <img class="rank5" src="Images\icon\star.png" alt=""/>
                <span class="di_al">订单已到达目的地</span>
                <span class="di_money">4 元</span>
                <p class="di_date">2016/4/12 18:31</p>
            </div>
            
            <div class="cart_data">
                <img class="dishpic" src="Images/dishes/dumpling.jpg" alt="食物图片"/><img class="spf" src="Images/icon/arrow2.png" alt="详情"/>
                <span class="di_name">水饺</span>
                <img class="rank1" src="Images\icon\star.png" alt=""/><img class="rank2" src="Images\icon\star.png" alt=""/>
                <img class="rank3" src="Images\icon\star.png" alt=""/><img class="rank4" src="Images\icon\star.png" alt=""/>
                <img class="rank5" src="Images\icon\star.png" alt=""/>
                <span class="di_al">订单已被商家接受</span>
                <span class="di_money">7 元</span>
                <p class="di_date">2016/4/11 19:11</p>
            </div>
            
            <div class="cart_data">
                <img class="dishpic" src="Images/dishes/fen.jpg" alt="食物图片"/><img class="spf" src="Images/icon/arrow2.png" alt="详情"/>
                <span class="di_name">牛肉粉</span>
                <img class="rank1" src="Images\icon\star1.png" alt=""/><img class="rank2" src="Images\icon\star.png" alt=""/>
                <img class="rank3" src="Images\icon\star.png" alt=""/><img class="rank4" src="Images\icon\star.png" alt=""/>
                <img class="rank5" src="Images\icon\star.png" alt=""/>
                <span class="di_al">订单正在配送</span>
                <span class="di_money">12 元</span>
                <p class="di_date">2016/4/12 19:58</p>
            </div>
            
            <div class="cart_data">
                <img class="dishpic" src="Images/dishes/zhou.jpg" alt="食物图片"/><img class="spf" src="Images/icon/arrow2.png" alt="详情"/>
                <span class="di_name">皮蛋瘦肉粥</span>
                <img class="rank1" src="Images\icon\star.png" alt=""/><img class="rank2" src="Images\icon\star.png" alt=""/>
                <img class="rank3" src="Images\icon\star.png" alt=""/><img class="rank4" src="Images\icon\star.png" alt=""/>
                <img class="rank5" src="Images\icon\star.png" alt=""/>
                <span class="di_al">订单已到达目的地</span>
                <span class="di_money">4 元</span>
                <p class="di_date">2016/4/12 18:31</p>
            </div>
            
            
        </div>      
        <div class="clearfix_foot"></div>
        <div class="footer">
            <table>
                <tr>
                    <td><a href="shoppage.html"><img class="mymenu" id="menu_bar" src="Images/icon/shop.png" alt="菜单" /><br/>菜单</a></td>
                    <td><a href="cartpage.html"  id="present"><img class="mymenu" id="cart_bar" src="Images/icon/cart1.png" alt="订单" /><br/>订单</a></td>
                    <td><a href="songpage.html"><img class="mymenu" id="song_bar" src="Images/icon/song.png" alt="配送"><br/>配送</a> </td>
                    <td><a href="mepage.html"><img class="mymenu" id="me_bar" src="Images/icon/me.png"  alt="我的" /><br/>我的</a></td>
                </tr>
            </table>
        </div>
    </body>
</html>
